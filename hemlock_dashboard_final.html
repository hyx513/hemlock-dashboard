
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hemlock Sample Tracker (Live)</title>
    <style>
        table {
            border-collapse: collapse;
            font-family: Arial, sans-serif;
            font-size: 14px;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: center;
            vertical-align: middle;
            min-width: 100px;
        }
    </style>
</head>
<body>
    <h2>Hemlock Sample Processing Dashboard</h2>
    <div id="table-container">Loading data...</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTfsBAqZc6V1Cm5vuuwblU5waymJqNFASrMZWfaY3uN0LACMT9Y0UGE3Wr1DQ4DIcOISWlPDt_CtR08/pub?output=csv";

        function createTable(data) {
            const container = document.getElementById("table-container");
            const byTP = {};

            // Group data by Timepoint and Location
            data.forEach(row => {
                const tp = row["Timepoint"];
                const loc = row["Location"];
                if (!byTP[tp]) byTP[tp] = {};
                byTP[tp][loc] = row;
            });

            const locations = [...new Set(data.map(d => d.Location))];
            const timepoints = [...new Set(data.map(d => d.Timepoint))];

            let html = "<table><tr><th>Timepoint</th>";
            locations.forEach(loc => html += `<th>${loc}</th>`);
            html += "</tr>";

            timepoints.forEach(tp => {
                html += `<tr><td>${tp}</td>`;
                locations.forEach(loc => {
                    const row = byTP[tp]?.[loc];
                    if (row) {
                        const total = row["Total Samples"];
                        const hs = row["GCMS_HS_Done"];
                        const liq = row["GCMS_LIQ_Done"];
                        const leaf = row["LCMS_Leaf_Done"];
                        const stem = row["LCMS_Stem_Done"];
                        const nmr = row["NMR_Done"];
                        const tooltip = 
                            "Missing HS: " + (row["Missing_GCMS_HS"] || "None") + "\n" +
                            "Missing Leaf: " + (row["Missing_LCMS_Leaf"] || "None") + 
                            (nmr === "Partial" ? "\nNMR: Partial" : "");

                        html += `<td title="${tooltip}">
                            <div style='color:#3f007d;'>HS: ${hs} / ${total}</div>
                            <div style='color:#9e9ac8;'>LIQ: ${liq} / ${total}</div>
                            <div style='color:#f768a1;'>Leaf: ${leaf} / ${total}</div>
                            <div style='color:#dd3497;'>Stem: ${stem} / ${total}</div>
                            <div style='color:#fdae6b;'>NMR: ${nmr}</div>
                        </td>`;
                    } else {
                        html += "<td>â€“</td>";
                    }
                });
                html += "</tr>";
            });

            html += "</table>";
            container.innerHTML = html;
        }

        fetch(sheetUrl)
            .then(res => res.text())
            .then(text => {
                const parsed = Papa.parse(text, {header: true});
                createTable(parsed.data);
            });
    </script>
</body>
</html>
